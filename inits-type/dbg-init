#!/bin/sh


function do_mount_proc {
	[ -d /proc ] || mkdir /proc
	mount -t proc proc    /proc      -o nodev,noexec,nosuid
}
function do_mount_sys {
	[ -d /sys ]  || mkdir /sys
	mount -t sysfs sysfs  /sys       -o nodev,noexec,nosuid
}
function do_mount_udev {
	[ -d /dev ]  || mkdir -m 0755 /dev
	mount -t devtmpfs udev  /dev
}
function do_mount_mdev {
	[ -d /dev ]  || mkdir -m 0755 /dev
	mount -t devtmpfs mdev  /dev
}
function do_mount_devpts {
	[ -d /dev/pts ] || mkdir /dev/pts
	mount -t devpts devpts   /dev/pts -o noexec,nosuid,gid=5,mode=0620
}

function do_run_shell {
	exec setsid cttyhack /bin/sh
}


echo
echo 'DBG_INIT ENTRY'
echo "RAADBG=$RAADBG"
IFS=','
for ACT in $RAADBG; do
	echo "-->$ACT"
	case $ACT in
		'PROC')
			do_mount_proc
			;;
		'SYS')
			do_mount_sys
			;;
		'UDEV')
			do_mount_udev
			;;
		'MDEV')
			do_mount_mdev
			;;
		'DEVPTS')
			do_mount_devpts
			;;
		'SHELL')
			do_run_shell
			;;
		*)
			echo "unsupported.. IGNORED"
			;;
	esac
done
